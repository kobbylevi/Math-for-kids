<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Game</title>
    <style>

        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            height: 100vh;
            margin: 0;
        }

        .upper {
            display: flex;
            flex-direction: row;
        }

        .upper-left {
            flex: 1;
            padding: 10px;
            align-items: center;
            text-align: center;
        }

        .upper-right {
            flex: 1;
            padding: 10px;
            align-items: center;
            text-align: center;
        }

        .lower {
            flex: 1;
            padding: 10px;
            align-items: center;
            text-align: center;
            height: 100%
        }

        #canvas-container {
            margin-right: 20px;
        }

        #problem-container {
            display: flex;
            flex-direction: column;
            margin-top: 20px;
        }

        #problem-label {
            font-size: 30px;
            margin-bottom: 10px;
        }

        #answer-input {
            font-size: 18px;
            padding: 5px;
            margin-bottom: 10px;
            width: 50%; /* Adjust the width as needed, e.g., 80% of the container width */
            margin-left: auto; /* Center the element by pushing it to the right */
            margin-right: auto; /* Center the element by pushing it to the left */
        }

        #submit-button {
            font-size: 18px;
            padding: 10px;
            width: 50%; /* Adjust the width as needed, e.g., 80% of the container width */
            margin-left: auto; /* Center the element by pushing it to the right */
            margin-right: auto; /* Center the element by pushing it to the left */
        }

        #video-options {
          display: flex;
          justify-content: space-around;
          margin-top: 20px;
        }

        /* Add pointer cursor on hover for the thumbnails */
        .thumbnail {
          cursor: pointer;
        }

        /* Add pointer cursor on hover for the Submit button */
        #submit-button {
            cursor: pointer;
        }
    </style>

</head>

<body>
    <script>
        const videoId1 = 'https://www.youtube.com/embed/oN8skMie2k8?si=ZGkVhqyhZoAl8fjI';
        const videoId2 = 'https://www.youtube.com/embed/r4wbdKmM3bQ?si=rh4MCdGk0hQkN6LH';
        const videoId3 = 'https://www.youtube.com/embed/fwY4EJRM7ak?si=kRrPoQmXVJEoLpof';
    </script>
    <div class="upper">
        <div class="upper-left">
                <div id="canvas-container">
                    <canvas id="canvas" width="100" height="500"></canvas>
                </div>
        </div>
        <div class="upper-right">
            <div id="problem-container">
                <label id="problem-label"></label>
                <div id="problem-display"></div>
                <input type="text" id="answer-input" placeholder="Enter answer" autofocus onkeyup="handleKeyPress(event)">
                <button id="submit-button" onclick="checkAnswer()">Submit</button>
                <div id="correct-answer" style="display: none;"></div>
            </div>
        </div>
    </div>
        <div class="lower">
            <div class="video-container"></div>
            <div id="video-options" style="display: none;">
              <img src="/media/carnaval.jpg" alt="Video 1 Thumbnail" class="thumbnail" width="320" height="180" onclick="chooseVideo(videoId1)">
              <img src="/media/unicorn.jpg" alt="Video 2 Thumbnail" class="thumbnail" width="320" height="180" onclick="chooseVideo(videoId2)">
              <img src="/media/resisim.jpg" alt="Video 3 Thumbnail" class="thumbnail" width="320" height="180" onclick="chooseVideo(videoId3)">
            </div>
        </div>
    </div>
</div>


    <script>
        let canvas = document.getElementById('canvas');
        let ctx = canvas.getContext('2d');
        let problemLabel = document.getElementById('problem-label');
        let answerInput = document.getElementById('answer-input');
        let answer;
        let VideoId;

        const NUM_STEPS = 10;  // Adjust as needed
        let currentLevel = NUM_STEPS - 1;
        let probability1 = 0; // Replace with the actual probability

        const correct_gifs = [
            'https://media.tenor.com/uFV671ovOhgAAAAC/spongebob-many.gif',
            'https://media.tenor.com/sOwqQjN8XPgAAAAC/spongebob-squarepants-toons.gif',
            'https://media.tenor.com/vLih9-ji-twAAAAC/spongebob-spongebob-squarepants.gif',
            'https://media.tenor.com/O3FkWgScIUMAAAAC/sponge-bob-thumbs-up.gif',
            'https://media.tenor.com/SSigufTXwhsAAAAC/spongebob-thumbs-up.gif',
            // Add more GIF URLs to this array as needed
        ];

        const incorrect_gifs = [
            'https://media.giphy.com/media/xTeV7FKRuo5YX714L6/giphy.gif',
            'https://media.giphy.com/media/3oxOCwwg0LvrKe5LoY/giphy.gif',
            'https://media.giphy.com/media/xT3i1jNFxlIPJSq4Ks/giphy.gif',
            'https://media.giphy.com/media/3oKHWzL4ymqnsXl6j6/giphy.gif',
            'https://gifdb.com/images/high/university-come-back-spongebob-3588l8jxklmb3pse.gif',
            // Add more GIF URLs to this array as needed
        ];

        const correctSounds = [
            'https://soundboardguy.com/wp-content/uploads/2021/10/clap.mp3',
            // Add more correct sound URLs as needed
        ];

        const incorrectSounds = [
            'https://us-tuna-sounds-files.voicemod.net/39850ac2-13db-4d70-a2a7-15373c9110ce-1653856084837.mp3',
            // Add more incorrect sound URLs as needed
        ];

        function handleKeyPress(event) {
          if (event.keyCode === 13) {
            checkAnswer();
          }
        }

        function createAdditionOrSubtractionProblem() {
            const operator = Math.random() < 0.5 ? '+' : '-';
            let num1, num2;

            if (operator === '+') {
                num1 = Math.floor(Math.random() * 21);
                num2 = Math.floor(Math.random() * (21 - num1));
                answer = Math.min(num1 + num2, 20);
            } else { // operator is '-'
                num1 = Math.floor(Math.random() * 21);
                num2 = Math.floor(Math.random() * (num1 + 1));
                answer = Math.min(num1 - num2, 20);
            }

            const problemText = `${num1} ${operator} ${num2} = ?`;

            // Display the problem with num1, operand, num2, and the equation
            document.getElementById('problem-label').textContent = problemText;

            // Store num1 and num2 in data attributes for future reference
            document.getElementById('problem-label').setAttribute('data-num1', num1);
            document.getElementById('problem-label').setAttribute('data-num2', num2);

            console.log("Num1: " + num1 + ", Num2: " + num2 + ", Operator: " + operator + ", Answer: " + answer);
            console.log("Problem: " + problemText);
        }


        function createMissingNumberProblem() {
            const operator = Math.random() < 0.5 ? '+' : '-';
            let num1, num2;
            if (operator === '+') {

                num1 = Math.floor(Math.random() * 21);
                num2 = Math.floor(Math.random() * (21 - num1));
                answer = Math.min(num1 + num2, 20);
                console.log('answer for operand + no var is.' + answer);
                const hideNum1 = Math.random() < probability1;

                if (hideNum1) {
                    problemText = ` ? ${operator} ${num1} = ${answer}`;
                } else {
                    problemText = `${num1} ${operator} ? = ${answer}`;
                }
            } else { // operator is '-'
                num1 = Math.floor(Math.random() * 21);
                num2 = Math.floor(Math.random() * (num1 + 1));
                answer = Math.min(num1 - num2, 20);
                console.log('answer for operand - with var is.' + answer);
                const hideNum1 = Math.random() < probability1;

                if (hideNum1) {
                    problemText = ` ? ${operator} ${num1} = ${answer}`;
                } else {
                    problemText = `${num1} ${operator} ? = ${answer}`;
                }
            }

            console.log("Num1: " + num1 + ", Num2: " + num2 + ", Operator: " + operator + ", Answer: " + answer);
            console.log("Problem: " + problemText);

            // Display the problem
            document.getElementById('problem-label').textContent = problemText;
        }

        function createProblem() {
            if (Math.random() < probability1) {
                createMissingNumberProblem();
            } else {
                createAdditionOrSubtractionProblem();
            }
        }

        function updateLadder() {
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            const stepSize = canvas.height / NUM_STEPS;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            for (let i = 0; i < NUM_STEPS; i++) {
                let color;
                if (i > currentLevel) {
                    color = 'green';
                } else if (i === currentLevel) {
                    color = 'blue';
                } else {
                    color = 'gray';
                }
                ctx.fillStyle = color;
                ctx.fillRect(0, i * stepSize, canvas.width, (i + 1) * stepSize);

                }
        }

        function checkAnswer() {
            const userAnswerElement = document.getElementById('answer-input');
            const userAnswer = userAnswerElement.value.trim();
            if (userAnswer === '') {
                alert('Please enter an answer.');  // Inform the user to provide an answer
                return;
                }

            if (parseInt(userAnswer) === answer) {
                currentLevel--; // Update the current level as needed

                // Show correct animation or message
                showCorrectGif();

                if (currentLevel < 0) {
                    // Display the video options
                    document.getElementById('video-options').style.display = 'block';

                }
            } else {
                if (currentLevel < NUM_STEPS - 1) {
                    currentLevel++; // Update the current level as needed
                }

                // Display correct answer
                const correctAnswerDiv = document.getElementById('correct-answer');
                correctAnswerDiv.innerText = 'The correct answer is: ' + answer;
                correctAnswerDiv.style.display = 'block';  // Show the correct answer

                // Move the ladder down
                moveDown();

                // Show incorrect animation or message
                showIncorrectGif();

                // Display correct answer
                console.log('answer is:' + answer);

            }

            // Update the ladder display
            updateLadder(currentLevel);

            // Create a new problem
            createProblem(probability1);
            document.getElementById('answer-input').value = '';  // Clear the answer input
        }

        function moveUp() {
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            const stepSize = canvas.height / NUM_STEPS;

            if (currentLevel < NUM_STEPS - 1) {
                currentLevel++; // Update the current level as needed
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                for (let i = 0; i < NUM_STEPS; i++) {
                    let color;
                    if (i > currentLevel) {
                        color = 'gray';
                    } else if (i === currentLevel) {
                        color = 'blue';
                    } else {
                        color = 'green';
                    }
                    ctx.fillStyle = color;
                    ctx.fillRect(0, i * stepSize, canvas.width, (i + 1) * stepSize);
                }
            }
        }

        function moveDown() {
            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            const stepSize = canvas.height / NUM_STEPS;

            if (currentLevel > 0) {
                currentLevel--; // Update the current level as needed
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                for (let i = 0; i < NUM_STEPS; i++) {
                    let color;
                    if (i > currentLevel) {
                        color = 'gray';
                    } else if (i === currentLevel) {
                        color = 'blue';
                    } else {
                        color = 'green';
                    }
                    ctx.fillStyle = color;
                    ctx.fillRect(0, i * stepSize, canvas.width, (i + 1) * stepSize);
                }
            }
        }

        function restartLadder() {
            currentLevel = NUM_STEPS - 1; // Reset the current level to the bottom

            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            const stepSize = canvas.height / NUM_STEPS;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            for (let i = 0; i < NUM_STEPS; i++) {
                let color;
                if (i > currentLevel) {
                    color = 'gray';
                } else if (i === currentLevel) {
                    color = 'blue';
                } else {
                    color = 'green';
                }
                ctx.fillStyle = color;
                ctx.fillRect(0, i * stepSize, canvas.width, (i + 1) * stepSize);
            }

            // Create a new problem
            createProblem(probability1);
            document.getElementById('problem-label').textContent = 'Problem: ' + '...';  // Update with the actual problem text
            document.getElementById('answer-input').value = '';  // Clear the answer input
        }

        function showIncorrectGif() {
            const lowerSection = document.querySelector('.lower');

            // Choose a random incorrect GIF from the array
            const randomIncorrectGifUrl = incorrect_gifs[Math.floor(Math.random() * incorrect_gifs.length)];

            const incorrectGif = document.createElement('img');
            incorrectGif.src = randomIncorrectGifUrl;
            incorrectGif.classList.add('incorrect-gif');

            // Append the GIF to the lower section
            lowerSection.appendChild(incorrectGif);

            // Center the GIF in the lower section
            incorrectGif.style.display = 'block';
            incorrectGif.style.margin = 'auto';

            // Set a timeout to hide the GIF after 3 seconds
            setTimeout(() => {
                incorrectGif.style.display = 'none';
            }, 3000);
            // Play a random incorrect sound
            playRandomSound(incorrectSounds);
        }

        function showCorrectGif() {
            // Play a random correct sound
            playRandomSound(correctSounds);
            if (currentLevel >= 0) {
                const lowerSection = document.querySelector('.lower');

                // Choose a random GIF from the array
                const randomGifUrl = correct_gifs[Math.floor(Math.random() * correct_gifs.length)];
                const correctGif = document.createElement('img');
                correctGif.src = randomGifUrl;
                correctGif.classList.add('correct-gif');

                // Append the GIF to the lower section
                lowerSection.appendChild(correctGif);

                // Center the GIF in the lower section
                correctGif.style.display = 'block';
                correctGif.style.margin = 'auto';

                // Set a timeout to hide the GIF after 3 seconds
                setTimeout(() => {
                    correctGif.style.display = 'none';
                }, 3000);

            }
        }

        function playRandomSound(soundsArray) {
            const randomSoundUrl = soundsArray[Math.floor(Math.random() * soundsArray.length)];
            const audio = new Audio(randomSoundUrl);
            audio.play();
        }

        function chooseVideo(videoId) {

            // Replace the video options with the embedded YouTube video
            const videoContainer = document.getElementById('video-options');
            videoContainer.innerHTML = `
            <iframe width="560" height="315" src="${videoId}" frameborder="0" allowfullscreen></iframe>
          `;
        }

        // Initialize the game
        createProblem();
        updateLadder();

    </script>
</body>
</html>
